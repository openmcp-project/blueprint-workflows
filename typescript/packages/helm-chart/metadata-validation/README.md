# Helm Chart Metadata Validation Action

Bash script for validating Helm Chart metadata and ensuring required fields are present in Chart.yaml files.

## Description

This shell-based action validates Helm Chart metadata by:

- Checking Chart.yaml files for required metadata fields
- Validating metadata completeness and format compliance
- Using `yq` for YAML field validation and extraction
- Providing detailed validation results and missing field reporting

## Usage

This bash script is designed to work with Helm Charts discovered through the chart listing system. It:

1. Reads the helm chart listing file to identify all charts
2. Validates each Chart.yaml file for required metadata fields
3. Checks field presence and basic format validation
4. Reports missing or invalid metadata fields
5. Generates human-friendly validation reports

## Required Metadata Fields

The script validates the following Chart.yaml fields:

```yaml
apiVersion: v2                    # ← Required: Chart API version
name: my-chart                    # ← Required: Chart name
description: "Chart description"   # ← Required: Chart description  
type: application                 # ← Required: Chart type
version: 1.2.3                   # ← Required: Semantic version
appVersion: "1.0"                # ← Required: Application version
icon: https://example.com/icon    # ← Required: Chart icon URL
sources:                         # ← Required: Source code URLs
  - https://github.com/example
kubeVersion: ">=1.20.0"          # ← Required: Kubernetes version compatibility
home: https://example.com         # ← Required: Project home page
maintainers:                     # ← Required: Chart maintainers
  - name: "Maintainer Name"
    email: "maintainer@example.com"
annotations:                     # ← Required: Chart annotations
  category: "web"
keywords:                        # ← Required: Chart keywords
  - web
  - nginx
deprecated: false                # ← Required: Deprecation status
```

## Script Execution

### Prerequisites

- `yq` tool must be installed and available in PATH
- Bash shell environment
- Helm chart listing file must exist (generated by listing action)

## Features

- **Field Validation**: Comprehensive validation of all required Chart.yaml metadata fields
- **Format Checking**: Basic format validation using yq YAML parser
- **Missing Field Detection**: Identifies and reports missing required fields
- **Batch Processing**: Validates all charts in the repository listing
- **Human-Friendly Output**: Generates readable validation reports
- **Error Reporting**: Clear error messages for validation failures

## Output Format

The script generates validation reports in `pr-status-check-human-friendly.txt` including:

- **Validation Summary**: Overview of charts processed
- **Field Status**: Per-chart field validation results
- **Missing Fields**: Detailed list of missing required fields
- **Error Details**: Specific validation errors and recommendations

## Error Handling

The script handles various validation scenarios:

- **Missing Chart.yaml**: Reports charts without metadata files
- **Invalid YAML**: Catches YAML parsing errors
- **Missing Fields**: Identifies incomplete metadata
- **Format Issues**: Reports field format validation problems

## Workflow Integration

The script integrates with CI/CD workflows by:

- Running after chart discovery and listing
- Validating metadata before chart packaging
- Providing early feedback on chart completeness
- Generating reports for chart quality assurance

## Exit Codes

- **0**: All charts passed metadata validation
- **1**: One or more charts failed validation or script errors occurred

## Dependencies

- **yq**: YAML processing tool for field extraction and validation
- **bash**: Shell environment for script execution
- **shared-variables.sh**: Common script configuration and utilities
- **Helm Chart Listing**: Requires chart listing file from listing action

## Validation Process

The validation process follows these steps:

1. **Environment Check**: Verifies required tools and variables are available
2. **Listing Validation**: Ensures helm chart listing file exists
3. **Chart Processing**: Iterates through all discovered charts
4. **Field Validation**: Checks each required field using yq queries
5. **Report Generation**: Creates human-readable validation summary

## Best Practices

For optimal metadata validation:

- Maintain complete Chart.yaml metadata for all charts
- Use semantic versioning for chart and application versions
- Include meaningful descriptions and keywords for discoverability
- Provide maintainer contact information
- Specify appropriate Kubernetes version constraints

## Integration with Other Actions

This validation works alongside:

- **listing**: Consumes chart discovery results
- **version-bump**: Validates version field format
- **linting**: Complements structural chart validation
- **docs**: Ensures metadata is available for documentation

## License

Apache-2.0