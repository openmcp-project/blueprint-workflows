# K8s Manifest Templating

GitHub Actions TypeScript action to template Kubernetes manifests from both Helm Charts and Kustomize projects.

## Description

This action processes projects found in listing files and generates Kubernetes manifests in the `./manifests/` directory:
- **Helm Charts**: Uses `helm template` to generate manifests
- **Kustomize Projects**: Uses `kustomize build` to generate manifests

## Prerequisites

- Helm CLI (for Helm chart processing)
- Kustomize CLI (for Kustomize project processing)
- A `helm-chart-listing.yaml` file (generated by helm-chart-listing action)
- A `kustomize-listing.yaml` file (generated by kustomize-listing action)

## Features

### Helm Chart Support
- Templates Helm charts using `helm template`
- Supports custom value files
- Configurable through `.ci.config.yaml`
- Default and additional manifest templating options

### Kustomize Support  
- Builds Kustomize projects using `kustomize build`
- Supports overlay configurations
- Configurable through `.ci.config.yaml`
- Default and additional manifest templating for different overlays

## Configuration

### Helm Charts Configuration

Configure in `.ci.config.yaml`:

```yaml
k8s-manifest-templating:
  ignoreWarnings: # list of regex patterns to ignore in stderr (optional)
    - "^walk\\.go:\\d+: found symbolic link in path: .*"
  helm-charts:
    default-manifest-templating: true
    additional-manifest-templating:
      - prefix-manifest-folder-name: "dev"
        value-files: ["values.yaml", "values.dev.yaml"]
      - prefix-manifest-folder-name: "prod"
        value-files: ["values.yaml", "values.prod.yaml"]
```

### Ignore Warnings

The `ignoreWarnings` option suppresses specific warnings from `helm template` stderr output:

- Accepts an array of regex patterns
- The pattern `^WARNING: This chart is deprecated$` is always ignored by default
- Useful for known harmless warnings like symbolic link warnings

### Kustomize Projects Configuration

Configure in `.ci.config.yaml`:

```yaml
k8s-manifest-templating:
  kustomize-projects:
    default-manifest-templating: true
    additional-manifest-templating:
      - prefix-manifest-folder-name: "dev"
        overlay-path: "overlays/dev"
      - prefix-manifest-folder-name: "prod"
        overlay-path: "overlays/prod"
```

## Output Structure

Generated manifests are organized in:
```
manifests/
├── helm/
│   ├── my-chart/
│   ├── dev.my-chart/
│   └── prod.my-chart/
└── kustomize/
    ├── my-app/
    ├── dev.my-app/
    └── prod.my-app/
```

## Process

1. **Helm Processing**: Reads `helm-chart-listing.yaml` and processes each chart
2. **Kustomize Processing**: Reads `kustomize-listing.yaml` and processes each project
3. **Manifest Generation**: Creates YAML files in appropriate directories
4. **Git Operations**: Commits and pushes generated manifests

## GitHub Actions Integration

Provides comprehensive summary tables showing:
- ✅ Successfully templated projects
- ⚠️ Projects with warnings  
- ❌ Projects that failed
- :heavy_exclamation_mark: Projects with templating disabled

## Dependencies

- @actions/core
- @actions/github
- helm CLI
- kustomize CLI
- yaml
